<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ª File Crash Test SimÃ¼latÃ¶rÃ¼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
            color: #fff;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .scenario {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .scenario h2 {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
            color: #ffd700;
        }
        
        .scenario p {
            margin-bottom: 1rem;
            line-height: 1.6;
        }
        
        .steps {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .steps ol {
            padding-left: 1.5rem;
        }
        
        .steps li {
            margin: 0.5rem 0;
            line-height: 1.6;
        }
        
        .result {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 8px;
        }
        
        .result.before {
            background: rgba(220, 38, 38, 0.2);
            border-left: 4px solid #dc2626;
        }
        
        .result.after {
            background: rgba(34, 197, 94, 0.2);
            border-left: 4px solid #22c55e;
        }
        
        .result h3 {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }
        
        .result ul {
            padding-left: 1.5rem;
        }
        
        .result li {
            margin: 0.3rem 0;
        }
        
        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .console-tip {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin-top: 1rem;
        }
        
        .console-tip strong {
            color: #ffd700;
        }
        
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-right: 0.5rem;
        }
        
        .badge.critical {
            background: #dc2626;
        }
        
        .badge.fixed {
            background: #22c55e;
        }
        
        .nav-buttons {
            text-align: center;
            margin-top: 2rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª File Crash Test SimÃ¼latÃ¶rÃ¼</h1>
        <p style="text-align: center; margin-bottom: 2rem; opacity: 0.9;">
            IndexedDB dosya yÃ¼kleme crash senaryolarÄ±nÄ± test et
        </p>

        <!-- SENARYO 1 -->
        <div class="scenario">
            <h2>
                <span class="badge critical">CRITICAL</span>
                Senaryo 1: HÄ±zlÄ± "Ä°ÅŸle" TÄ±klama
            </h2>
            <p>
                <strong>SimÃ¼lasyon:</strong> Ä°hale Robotu â†’ Yeni Analiz OluÅŸtur â†’ Dosyalar yÃ¼klenirken Ä°ÅŸle butonuna basma
            </p>
            
            <div class="steps">
                <strong>ğŸ“ Test AdÄ±mlarÄ±:</strong>
                <ol>
                    <li>Console'u aÃ§ (âŒ˜+Option+J veya F12)</li>
                    <li><a href="/ihale-robotu" style="color: #ffd700;">/ihale-robotu</a> sayfasÄ±na git</li>
                    <li>Herhangi bir ihale seÃ§</li>
                    <li>"Yeni Analiz OluÅŸtur" butonuna tÄ±kla</li>
                    <li><strong>HEMEN</strong> ilk dosyanÄ±n "Ä°ÅŸle" butonuna bas (yÃ¼kleme tamamlanmadan!)</li>
                </ol>
            </div>

            <div class="result before">
                <h3>âŒ Ã–nceki DavranÄ±ÅŸ (Crash)</h3>
                <ul>
                    <li>TypeError: Cannot read property of undefined</li>
                    <li>White screen of death</li>
                    <li>Error boundary tetikleniyor</li>
                    <li>KullanÄ±cÄ± sayfayÄ± kaybediyor</li>
                </ul>
            </div>

            <div class="result after">
                <h3>âœ… Yeni DavranÄ±ÅŸ (GÃ¼venli)</h3>
                <ul>
                    <li>Toast: "âŒ Dosya yÃ¼klenemedi - file objesi bulunamadÄ±"</li>
                    <li>Console: "ğŸ›¡ï¸ SERT GÃœVENLÄ°K KONTROLÃœ"</li>
                    <li>Console: "ğŸ“¦ MAP KEYS BEFORE PROCESS: []"</li>
                    <li>File status â†’ error</li>
                    <li>Sayfa aÃ§Ä±k kalÄ±yor, kullanÄ±cÄ± yeniden deneyebilir</li>
                </ul>
            </div>

            <div class="console-tip">
                <strong>Console Filtreleri:</strong><br>
                â€¢ <code>filter: "SERT GÃœVENLÄ°K"</code> - GÃ¼venlik kontrollerini gÃ¶r<br>
                â€¢ <code>filter: "MAP KEYS"</code> - fileObjectsMapRef iÃ§eriÄŸini izle<br>
                â€¢ <code>filter: "CRITICAL"</code> - Kritik hatalarÄ± yakala
            </div>
        </div>

        <!-- SENARYO 2 -->
        <div class="scenario">
            <h2>
                <span class="badge critical">CRITICAL</span>
                Senaryo 2: Component Unmount
            </h2>
            <p>
                <strong>SimÃ¼lasyon:</strong> IndexedDB yÃ¼klenirken geri butonu ile sayfadan Ã§Ä±kma
            </p>
            
            <div class="steps">
                <strong>ğŸ“ Test AdÄ±mlarÄ±:</strong>
                <ol>
                    <li>Console Network tab'Ä±nÄ± aÃ§</li>
                    <li>/ihale-robotu â†’ Ä°hale seÃ§ â†’ "Yeni Analiz OluÅŸtur"</li>
                    <li>URL'de <code>?from=ihale_docs_xxxxx</code> parametresini gÃ¶r</li>
                    <li>Dosyalar "PENDING" durumuna gelirken <strong>HEMEN</strong> geri butonuna bas</li>
                    <li>Console'da cleanup logunu kontrol et</li>
                </ol>
            </div>

            <div class="result before">
                <h3>âŒ Ã–nceki DavranÄ±ÅŸ (Memory Leak)</h3>
                <ul>
                    <li>Warning: Can't perform state update on unmounted component</li>
                    <li>fileObjectsMapRef.current sÄ±fÄ±rlanÄ±yor</li>
                    <li>Async iÅŸlem devam ediyor ama state gÃ¼ncellenmiyor</li>
                    <li>Memory leak</li>
                </ul>
            </div>

            <div class="result after">
                <h3>âœ… Yeni DavranÄ±ÅŸ (Temiz Cleanup)</h3>
                <ul>
                    <li>Console: "ğŸ§¹ IndexedDB useEffect cleanup - component unmounting"</li>
                    <li><code>isMounted = false</code> â†’ state gÃ¼ncellemeleri durur</li>
                    <li>fileObjectsMapRef korunur</li>
                    <li>Memory leak yok</li>
                    <li>Unmounted component uyarÄ±sÄ± yok</li>
                </ul>
            </div>

            <div class="console-tip">
                <strong>Console Filtreleri:</strong><br>
                â€¢ <code>filter: "cleanup"</code> - Cleanup iÅŸlemlerini gÃ¶r<br>
                â€¢ <code>filter: "unmounting"</code> - Component lifecycle'Ä± izle<br>
                â€¢ <code>filter: "isMounted"</code> - Mount durumunu kontrol et
            </div>
        </div>

        <!-- SENARYO 3 -->
        <div class="scenario">
            <h2>
                <span class="badge fixed">FIXED</span>
                Senaryo 3: File Objesi KaybÄ±
            </h2>
            <p>
                <strong>SimÃ¼lasyon:</strong> Dosya ekleniyor â†’ Map'ten siliniyor â†’ Ä°ÅŸle butonuna basÄ±lÄ±yor
            </p>
            
            <div class="steps">
                <strong>ğŸ“ Test AdÄ±mlarÄ± (Manuel ManipÃ¼lasyon):</strong>
                <ol>
                    <li>/ihale/yeni-analiz sayfasÄ±na git</li>
                    <li>Bir dosya yÃ¼kle (PDF/DOCX)</li>
                    <li>Console'da ÅŸunu Ã§alÄ±ÅŸtÄ±r:</li>
                    <code style="display: block; background: rgba(0,0,0,0.3); padding: 0.5rem; margin: 0.5rem 0; border-radius: 4px;">
                        // fileObjectsMapRef'i temizle (simÃ¼lasyon)<br>
                        window.debugClearFileMap = true;
                    </code>
                    <li>"Ä°ÅŸle" butonuna bas</li>
                </ol>
            </div>

            <div class="result before">
                <h3>âŒ Ã–nceki DavranÄ±ÅŸ</h3>
                <ul>
                    <li>processSingleFile(undefined) Ã§aÄŸrÄ±lÄ±r</li>
                    <li>TypeError: Cannot read property 'name' of undefined</li>
                    <li>Generic error boundary mesajÄ±</li>
                </ul>
            </div>

            <div class="result after">
                <h3>âœ… Yeni DavranÄ±ÅŸ</h3>
                <ul>
                    <li>Console: "âš ï¸ File object Map'te bulunamadÄ±: dosya.pdf"</li>
                    <li>Console: "ğŸ“‹ Mevcut Map keys: []"</li>
                    <li>Toast: "âŒ File objesi bulunamadÄ± ve URL'den de indirilemedi"</li>
                    <li>KullanÄ±cÄ±ya net talimat: "DosyayÄ± yeniden yÃ¼kleyin"</li>
                    <li>File status â†’ error</li>
                </ul>
            </div>

            <div class="console-tip">
                <strong>Debug Helper:</strong><br>
                Console'da Ã§alÄ±ÅŸtÄ±r: <code>Array.from(fileObjectsMapRef.current.keys())</code><br>
                Bu komut mevcut file objelerini listeler.
            </div>
        </div>

        <!-- NAVÄ°GASYON -->
        <div class="nav-buttons">
            <a href="/ihale-robotu" class="btn">ğŸš€ Ä°hale Robotu'na Git</a>
            <a href="/ihale/yeni-analiz" class="btn">ğŸ“„ Yeni Analiz SayfasÄ±</a>
            <a href="/" class="btn">ğŸ  Ana Sayfa</a>
        </div>

        <div style="margin-top: 2rem; padding: 1rem; background: rgba(0,0,0,0.3); border-radius: 8px; font-size: 0.9rem;">
            <strong>ğŸ’¡ Pro Tips:</strong>
            <ul style="padding-left: 1.5rem; margin-top: 0.5rem;">
                <li>Chrome DevTools â†’ Console â†’ "Preserve log" aktif et (refresh sonrasÄ± loglarÄ± kaybet)</li>
                <li>Network tab'Ä±nda "Disable cache" iÅŸaretle (IndexedDB refresh'lerini test et)</li>
                <li>React DevTools ile component lifecycle'Ä± izle</li>
                <li>Application tab â†’ IndexedDB â†’ ihale_docs veritabanÄ±nÄ± incele</li>
            </ul>
        </div>

        <div style="text-align: center; margin-top: 2rem; opacity: 0.7; font-size: 0.9rem;">
            <p>ğŸ”§ Test OrtamÄ±: Next.js 16 + React 19 + TypeScript</p>
            <p>ğŸ“… Test Tarihi: 7 KasÄ±m 2025</p>
        </div>
    </div>

    <script>
        // Debug helper - global scope'a ekle
        window.addEventListener('DOMContentLoaded', () => {
            console.log('%cğŸ§ª File Crash Test SimÃ¼latÃ¶rÃ¼ YÃ¼klendi', 'font-size: 16px; font-weight: bold; color: #667eea;');
            console.log('%cTest senaryolarÄ±nÄ± baÅŸlatmak iÃ§in yukarÄ±daki talimatlarÄ± takip edin.', 'color: #888;');
            console.log('%c\nğŸ“Š KullanÄ±labilir Console Filtreleri:', 'font-weight: bold;');
            console.log('  â€¢ filter: "SERT GÃœVENLÄ°K"');
            console.log('  â€¢ filter: "MAP KEYS"');
            console.log('  â€¢ filter: "cleanup"');
            console.log('  â€¢ filter: "CRITICAL"');
        });
    </script>
</body>
</html>
