version: '3.8'

services:
  procheff:
    build: .
    container_name: procheff-app
    restart: unless-stopped

    ports:
      - "3000:3000"

    environment:
      # Node environment
      - NODE_ENV=production

      # API Keys (docker-compose.override.yml'de override edilecek)
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - GEMINI_API_KEY=${GEMINI_API_KEY}

      # Database
      - TURSO_DATABASE_URL=${TURSO_DATABASE_URL}
      - TURSO_AUTH_TOKEN=${TURSO_AUTH_TOKEN}

      # Scraper
      - SCRAPER_API_KEY=${SCRAPER_API_KEY}
      - IHALEBUL_USERNAME=${IHALEBUL_USERNAME}
      - IHALEBUL_PASSWORD=${IHALEBUL_PASSWORD}
      - CRON_SECRET=${CRON_SECRET}

      # App settings
      - NEXT_PUBLIC_APP_URL=http://localhost:3000
      - AI_DEBUG=false

    volumes:
      # Data persistence (veritabanÄ±)
      - procheff-data:/app/data
      # Logs persistence
      - procheff-logs:/app/logs
      # Temp files
      - procheff-tmp:/app/tmp

    # Security
    security_opt:
      - no-new-privileges:true

    # Resource limits
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '1'
          memory: 512M

    # Health check
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  procheff-data:
    driver: local
  procheff-logs:
    driver: local
  procheff-tmp:
    driver: local
