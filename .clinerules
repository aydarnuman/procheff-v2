# Procheff-v2 - Claude TalimatlarÄ±

## ğŸ¯ Proje HakkÄ±nda

Bu proje, ihale dokÃ¼manlarÄ±nÄ± (PDF, DOCX, CSV) yÃ¼kleyip AI ile analiz eden bir Next.js uygulamasÄ±dÄ±r.

- **Ä°hale Takip Sistemi**: SQLite database ile yerel ihale takibi
- **AI-powered Scraping**: Claude AI ile otomatik ihale Ã§ekme ve parse etme
- **Smart Integration**: Ä°hale Takip'ten direkt dosya seÃ§imi
- Dosya upload ve iÅŸleme
- Claude AI ve Gemini ile dokÃ¼man analizi
- Dashboard ve raporlama

---

## ğŸ› ï¸ Teknoloji Stack

### Core

- **Framework**: Next.js 16.0.1 (App Router)
- **React**: 19.2.0
- **TypeScript**: Zorunlu, strict mode
- **Styling**: Tailwind CSS 4

### State & Data

- **State Management**: Zustand (global state iÃ§in)
  - Stores: `/lib/stores/` (menu-store.ts, price-store.ts, analysis-store.ts)
- **Database**: SQLite (local) + Supabase (planned)
  - **Ä°hale Takip**: Local SQLite (`/data/ihale-scraper.db`)
    - Tablo: `tenders` (ihale bilgileri)
    - Schema: `/lib/ihale-scraper/database/schema.sql`
    - Client: `/lib/ihale-scraper/database/sqlite-client.ts`
- **API**: Next.js API Routes
  - `/api/ai/*` - AI analiz endpoints
  - `/api/cron/*` - Cron job endpoints (CRON_SECRET ile korumalÄ±)
  - `/api/ihale-scraper/*` - Scraper yÃ¶netim endpoints
    - `list` - Ä°hale listesi (SQLite'dan)
    - `fetch-full-content` - AI ile ihale Ã§ekme (Puppeteer + Claude)
    - `download-document` - DÃ¶kÃ¼man indirme (proxy)

### AI & File Processing

- **AI Models**:
  - Anthropic Claude SDK (@anthropic-ai/sdk) - Ä°hale analizi
  - Google Generative AI (Gemini 2.0 Flash) - ÃœrÃ¼n tespiti, Ä°hale kategorilendirme
    - Free tier: 1,500 request/gÃ¼n
    - Rate limit: Dakikada 8 request (gÃ¼venli marj)
    - **UYARI**: Scraper'Ä± manuel sÄ±k test etme (kota tÃ¼ketir!)
- **File Processing**:
  - PDF: pdf-lib, pdf2json, jspdf
  - DOCX: mammoth
  - Upload: multer, formidable
  - Extraction: textract

### UI & Animation

- **Icons**: lucide-react
- **Animation**: framer-motion
- **Theme**: next-themes (dark/light mode)

---

## ğŸ“ Kod Stili KurallarÄ±

### TypeScript

âœ… **YAPILMASI GEREKENLER:**

- Her zaman TypeScript kullan, JavaScript yazma
- Strict mode aktif
- Type'larÄ± explicit tanÄ±mla
- Interface ve type'larÄ± net isimlendirme

âŒ **YAPILMAMASI GEREKENLER:**

- `any` type kullanma (unknown veya proper type kullan)
- Type assertion yerine type guard kullan
- `@ts-ignore` yazma

```typescript
// âœ… Ä°yi
interface AnalysisResult {
  success: boolean;
  data: string;
  error?: string;
}

// âŒ KÃ¶tÃ¼
const result: any = await analyze();
```

### React Components

âœ… **YAPILMASI GEREKENLER:**

- Fonksiyonel componentler (React 19)
- Arrow function syntax: `const Component = () => {}`
- TypeScript ile prop typing
- Named exports (default export yerine)

âŒ **YAPILMAMASI GEREKENLER:**

- Class componentler yazma
- Inline styles kullanma (Tailwind kullan)
- Direct DOM manipulation

```typescript
// âœ… Ä°yi
interface ButtonProps {
  onClick: () => void;
  children: React.ReactNode;
}

export const Button = ({ onClick, children }: ButtonProps) => {
  return <button onClick={onClick}>{children}</button>;
};

// âŒ KÃ¶tÃ¼
export default function Button(props: any) {
  return <button style={{ color: "red" }}>{props.children}</button>;
}
```

### Async/Await

âœ… **YAPILMASI GEREKENLER:**

- async/await kullan
- Try-catch ile error handling
- Loading ve error state'leri yÃ¶net

âŒ **YAPILMAMASI GEREKENLER:**

- `.then().catch()` zincirleme
- Error handling yapmamak

```typescript
// âœ… Ä°yi
const analyzeDocument = async (file: File): Promise<AnalysisResult> => {
  try {
    const response = await fetch("/api/analyze", {
      method: "POST",
      body: formData,
    });

    if (!response.ok) {
      throw new Error("Analysis failed");
    }

    return await response.json();
  } catch (error) {
    console.error("Analysis error:", error);
    throw error;
  }
};

// âŒ KÃ¶tÃ¼
const analyzeDocument = (file) => {
  return fetch("/api/analyze")
    .then((res) => res.json())
    .catch((err) => console.log(err));
};
```

---

## ğŸ“ Proje YapÄ±sÄ±

```
/app                      # Next.js App Router
  /api                   # API routes
    /ai                  # AI analiz endpoints (detect-product, full-analysis, etc.)
    /cron                # Cron job endpoints (delete-tenders, scrape-tenders)
    /ihale-scraper       # Scraper yÃ¶netim (stats, list, validate, etc.)
  /components            # Page-specific components
  /ihale-takip          # Ä°hale takip sayfasÄ±
  /menu-planner         # MenÃ¼ planlama sayfasÄ±
  /price-feed           # Market fiyatlarÄ± sayfasÄ±
  /[page]               # DiÄŸer sayfalar
/components              # Shared/reusable components
  /ui                   # UI primitives
  /modals               # Modal components
/lib                    # Utility functions
  /ai                   # AI helper functions
  /ihale-scraper        # Ä°hale scraper sistemi
    /ai                 # Gemini categorizer
    /scrapers           # Scraper implementations (ihalebul, ekap, ilan-gov)
    /database           # Supabase client
    /notifications      # Bildirim servisi
  /stores               # Zustand stores (menu-store, price-store)
  /supabase             # Supabase client
/supabase               # Supabase yapÄ±landÄ±rmasÄ±
  /migrations           # Database migrations
/types                  # TypeScript types & interfaces
/public                 # Static assets
```

### Dosya Organizasyonu

- Components: `/components` (shared) veya `/app/components` (page-specific)
- Utils: `/lib` altÄ±nda kategorize et
- Types: `/types` klasÃ¶rÃ¼nde global type'lar
- API routes: `/app/api` altÄ±nda
  - AI endpoints: `/app/api/ai/*`
  - Cron jobs: `/app/api/cron/*`
  - Scraper: `/app/api/ihale-scraper/*`
- Stores: `/lib/stores/` (Zustand global state)
- Scraper: `/lib/ihale-scraper/` (Ä°hale scraper sistemi)

---

## ğŸ¨ Styling KurallarÄ±

### Tailwind CSS

âœ… **YAPILMASI GEREKENLER:**

- Tailwind utility classes kullan
- Responsive design: `sm:`, `md:`, `lg:` breakpoints
- Dark mode support: `dark:` prefix
- Framer Motion ile animasyonlar

âŒ **YAPILMAMASI GEREKENLER:**

- Inline styles yazma
- CSS dosyalarÄ± oluÅŸturma (globals.css hariÃ§)
- !important kullanma

```typescript
// âœ… Ä°yi
<div className="flex items-center gap-4 p-6 bg-white dark:bg-gray-900 rounded-lg shadow-md">
  <h1 className="text-2xl font-bold text-gray-900 dark:text-white">
    BaÅŸlÄ±k
  </h1>
</div>

// âŒ KÃ¶tÃ¼
<div style={{ display: 'flex', padding: '24px', backgroundColor: 'white' }}>
  <h1 style={{ fontSize: '24px', fontWeight: 'bold' }}>BaÅŸlÄ±k</h1>
</div>
```

---

## ğŸ” API & Backend

### API Routes

âœ… **YAPILMASI GEREKENLER:**

- Next.js 16 App Router API routes kullan
- Error handling ve status codes
- Request validation
- Type-safe responses

```typescript
// /app/api/analyze/route.ts
import { NextRequest, NextResponse } from "next/server";

export async function POST(request: NextRequest) {
  try {
    const formData = await request.formData();
    const file = formData.get("file") as File;

    if (!file) {
      return NextResponse.json({ error: "File required" }, { status: 400 });
    }

    // Process file...

    return NextResponse.json({ success: true, data: result });
  } catch (error) {
    console.error("API error:", error);
    return NextResponse.json(
      { error: "Internal server error" },
      { status: 500 }
    );
  }
}
```

### Supabase

âœ… **YAPILMASI GEREKENLER:**

- Client-side: `createClient` from `@supabase/supabase-js`
- Server-side: Server component'lerde kullan
- Type-safe queries
- Error handling

---

## ğŸ¤– AI Integration

### Claude & Gemini

âœ… **YAPILMASI GEREKENLER:**

- Environment variables ile API keys
- Streaming responses destekle
- Token limitlerine dikkat et
- Error handling ve retry logic
- **Gemini quota yÃ¶netimi**: Rate limiting ve retry mekanizmasÄ±

```typescript
// âœ… Ä°yi - Claude kullanÄ±mÄ±
import Anthropic from "@anthropic-ai/sdk";

const analyzeWithClaude = async (content: string) => {
  try {
    const anthropic = new Anthropic({
      apiKey: process.env.ANTHROPIC_API_KEY,
    });

    const message = await anthropic.messages.create({
      model: "claude-sonnet-4-5-20250929",
      max_tokens: 4096,
      messages: [
        {
          role: "user",
          content: `Analyze this document: ${content}`,
        },
      ],
    });

    return message.content;
  } catch (error) {
    console.error("Claude API error:", error);
    throw new Error("AI analysis failed");
  }
};

// âœ… Ä°yi - Gemini kullanÄ±mÄ± (quota yÃ¶netimi ile)
import { GoogleGenerativeAI } from '@google/generative-ai';

const analyzeWithGemini = async (prompt: string, retryCount: number = 0) => {
  const maxRetries = 3;
  const genai = new GoogleGenerativeAI(process.env.GEMINI_API_KEY!);
  const model = genai.getGenerativeModel({
    model: process.env.GEMINI_MODEL || 'gemini-2.0-flash-exp'
  });

  try {
    const result = await model.generateContent(prompt);
    return result.response.text();
  } catch (error: any) {
    // Rate limit hatasÄ± kontrolÃ¼ (429)
    const isRateLimit = error?.message?.includes('429') ||
                       error?.message?.includes('quota') ||
                       error?.message?.includes('rate limit');

    if (isRateLimit && retryCount < maxRetries) {
      const retryDelay = 15000; // 15 saniye bekle
      console.log(`â³ Rate limit! ${retryDelay / 1000}s bekleniyor...`);
      await new Promise(resolve => setTimeout(resolve, retryDelay));
      return analyzeWithGemini(prompt, retryCount + 1);
    }

    throw error;
  }
};
```

### Gemini API Quota YÃ¶netimi

**Free Tier Limitler:**
- **GÃ¼nlÃ¼k**: 1,500 request
- **DakikalÄ±k**: 15 request (gÃ¼venli: 8 request/dakika kullan)

**Rate Limiting Stratejisi:**
```typescript
// Ä°hale scraper iÃ§in batch processing
const SAFE_REQUESTS_PER_MINUTE = 8; // 15'in altÄ±nda kal
const DELAY_BETWEEN_REQUESTS = Math.ceil(60000 / SAFE_REQUESTS_PER_MINUTE); // 7500ms

for (let i = 0; i < items.length; i++) {
  await processItem(items[i]);
  if (i < items.length - 1) {
    await sleep(DELAY_BETWEEN_REQUESTS); // 7.5 saniye bekle
  }
}
```

**Kota KontrolÃ¼:**
- âœ… Cron job gÃ¼nde 1 kere Ã§alÄ±ÅŸÄ±r (~200-300 request)
- âŒ Scraper'Ä± manuel sÄ±k test etme (her test ~218 request)
- âœ… ÃœrÃ¼n ekleme ayrÄ± kota kullanÄ±r (aynÄ± key ama farklÄ± endpoint)

---

## ğŸ“¤ File Upload & Processing

### File Handling

âœ… **YAPILMASI GEREKENLER:**

- Multer veya formidable ile upload
- File type validation
- Size limits
- Error handling

âŒ **YAPILMAMASI GEREKENLER:**

- File'larÄ± direkt memory'de tutma
- Validation atlama

```typescript
// âœ… Ä°yi - File validation
const validateFile = (file: File) => {
  const allowedTypes = [
    "application/pdf",
    "text/csv",
    "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
  ];
  const maxSize = 10 * 1024 * 1024; // 10MB

  if (!allowedTypes.includes(file.type)) {
    throw new Error("Invalid file type");
  }

  if (file.size > maxSize) {
    throw new Error("File too large");
  }
};
```

---

## ğŸ¯ State Management (Zustand)

### Store YapÄ±sÄ±

**Store Konumu**: `/lib/stores/` (Ã§oÄŸul - Ã–NEMLÄ°!)

âœ… **YAPILMASI GEREKENLER:**

- KÃ¼Ã§Ã¼k, focused store'lar oluÅŸtur
- TypeScript ile type et
- Immer middleware kullan (gerekirse)
- Store'larÄ± `/lib/stores/` altÄ±nda tut

```typescript
// âœ… Ä°yi - /lib/stores/analysis-store.ts
import { create } from "zustand";

interface AnalysisStore {
  isAnalyzing: boolean;
  result: AnalysisResult | null;
  error: string | null;
  setAnalyzing: (value: boolean) => void;
  setResult: (result: AnalysisResult) => void;
  setError: (error: string) => void;
  reset: () => void;
}

export const useAnalysisStore = create<AnalysisStore>((set) => ({
  isAnalyzing: false,
  result: null,
  error: null,
  setAnalyzing: (value) => set({ isAnalyzing: value }),
  setResult: (result) => set({ result, error: null }),
  setError: (error) => set({ error, isAnalyzing: false }),
  reset: () => set({ isAnalyzing: false, result: null, error: null }),
}));
```

**Mevcut Store'lar:**
- `/lib/stores/menu-store.ts` - MenÃ¼ yÃ¶netimi
- `/lib/stores/price-store.ts` - Fiyat yÃ¶netimi

---

## âœ… Testing

### Test Scripts

- `npm run test:smoke` - Smoke tests
- `npm run test:ai` - AI extraction tests

âœ… **YAPILMASI GEREKENLER:**

- Critical flow'larÄ± test et
- API endpoint'leri test et
- File processing'i test et

---

## ğŸš« Genel Yasaklar

âŒ **ASLA YAPMA:**

1. `console.log()` production code'da bÄ±rakma (development iÃ§in ok)
2. `any` type kullanma
3. Inline styles yazma
4. Error handling yapmamak
5. API key'leri hardcode etme
6. Direct DOM manipulation
7. Class component yazma
8. Global state'i gereksiz kullanma
9. File validation atlama
10. Next.js 16 conventions'a uymamak

---

## ğŸ¯ Best Practices

### Performance

- Server Component'leri default olarak kullan
- Client Component'leri sadece gerektiÄŸinde kullan (`'use client'`)
- Dynamic import ile code splitting
- Image optimization (next/image)

### Security

- Environment variables ile sensitive data
- Input validation her zaman
- File upload gÃ¼venliÄŸi
- API rate limiting

### Code Quality

- ESLint kurallarÄ±na uy
- Meaningful variable names
- Functions: tek sorumluluk prensibi
- Comments: sadece "neden" aÃ§Ä±kla, "ne" deÄŸil

---

## ğŸ”„ Development Workflow

### Scripts

```bash
npm run dev          # Development server
npm run build        # Production build
npm run lint         # Lint check
npm run clean        # Clean cache
npm run fresh        # Fresh install + dev
npm run test:smoke   # Smoke tests
npm run test:ai      # AI tests
```

### Environment Variables

**Zorunlu:**
```bash
# Anthropic Claude API (Ä°hale analizi)
ANTHROPIC_API_KEY=sk-ant-...

# Google Gemini API (ÃœrÃ¼n tespiti, Ä°hale kategorilendirme)
GEMINI_API_KEY=AIzaSy...
GEMINI_MODEL=gemini-2.0-flash-exp

# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://...supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJ...

# Cron Job GÃ¼venliÄŸi
CRON_SECRET=your-secure-secret-key
```

**Ä°steÄŸe BaÄŸlÄ±:**
```bash
# Sentry (Hata takibi)
SENTRY_DSN=https://...@sentry.io/...
```

### Git

- Meaningful commit messages
- Feature branch'ler kullan
- PR'den Ã¶nce test et

---

## ğŸ“š Kaynaklar

- Next.js 16: https://nextjs.org/docs
- React 19: https://react.dev
- Tailwind CSS 4: https://tailwindcss.com
- Zustand: https://docs.pmnd.rs/zustand
- Supabase: https://supabase.com/docs
- Anthropic Claude: https://docs.anthropic.com

---

## ğŸ’¡ Ã–zel Notlar

Bu proje iÃ§in:

1. **AI analiz kalitesi** kritik - her zaman error handling yap
2. **File processing** gÃ¼venli olmalÄ± - validation asla atlama
3. **Performance** Ã¶nemli - large files iÃ§in streaming kullan
4. **User experience** Ã¶ncelik - loading states ve error messages net olsun
5. **Type safety** her yerde - TypeScript'in gÃ¼cÃ¼nÃ¼ kullan

### Ä°hale Scraper Sistemi

**Cron Job YapÄ±sÄ±** (Vercel):
- **09:50 UTC** (TR 12:50): Eski ihaleleri sil
- **10:00 UTC** (TR 13:00): Yeni ihaleleri scrape et

**Scraper Ã–zellikleri:**
- 3 kaynak: ihalebul, ekap, ilan.gov.tr
- Gemini ile otomatik kategorilendirme (catering tespiti)
- Rate limiting: Dakikada 8 request (gÃ¼venli marj)
- SQLite veritabanÄ±na otomatik kayÄ±t
- **Metadata Caching**: Ä°ki aÅŸamalÄ± veri Ã§ekme sistemi

**Metadata Caching Pattern:**
- **Liste sayfasÄ±**: BaÅŸlÄ±k, kurum, ÅŸehir bilgilerini cache'le
- **Detay sayfasÄ±**: Cache'lenmiÅŸ veriyi Ã¶ncelikle kullan, detay sayfadan zenginleÅŸtir
- **Avantajlar**: %100 doÄŸruluk, kayÄ±p veri yok, DOM deÄŸiÅŸikliklerine daha dayanÄ±klÄ±
- **Implementasyon**: `Map<sourceId, {title, organization, city}>` yapÄ±sÄ±

**UYARILAR:**
- âŒ Scraper'Ä± manuel sÄ±k test etme (her test ~218 Gemini request = kota tÃ¼ketir!)
- âœ… Cron job'a bÄ±rak (gÃ¼nde 1 kere otomatik Ã§alÄ±ÅŸÄ±r)
- âœ… Test iÃ§in `/api/ihale-scraper/stats` endpoint'ini kullan (kota harcamaz)

---

## ğŸ‘¤ KÄ°ÅÄ°SEL TALÄ°MATLAR

### Dil ve Ä°letiÅŸim Tercihleri

âœ… **Yorum SatÄ±rlarÄ±**: TÃ¼rkÃ§e
âœ… **DeÄŸiÅŸken Ä°simleri**: TÃ¼rkÃ§e (Ã¶rn: `kullaniciAdi`, `dosyaYukle`, `analizSonucu`)
âœ… **AÃ§Ä±klama TarzÄ±**: KÄ±sa ve Ã¶z - gereksiz detaya girme, sadece gerekeni sÃ¶yle

```typescript
// âœ… Ä°yi - TÃ¼rkÃ§e deÄŸiÅŸkenler ve yorumlar
const dosyaYukle = async (dosya: File) => {
  // Dosya tipini kontrol et
  if (!izinVerilenTipler.includes(dosya.type)) {
    throw new Error("GeÃ§ersiz dosya tipi");
  }
};

// âŒ KÃ¶tÃ¼ - Ä°ngilizce deÄŸiÅŸkenler
const uploadFile = async (file: File) => {
  // Check file type
  if (!allowedTypes.includes(file.type)) {
    throw new Error("Invalid file type");
  }
};
```

### Ä°ÅŸ AkÄ±ÅŸÄ± KurallarÄ±

#### 1. Ã–NCE TARTIÅALIM, SONRA KODLAYALIM ğŸ—£ï¸

âŒ **HEMEN KOD YAZMA!**
âœ… **Ã–nce ÅŸunlarÄ± yap:**

**ADIM 1**: Durumu analiz et ve seÃ§enekler sun:

```
"Bu iÅŸi 3 farklÄ± ÅŸekilde yapabiliriz:

SeÃ§enek A: [YÃ¶ntem 1]
  âœ… AvantajlarÄ±: ...
  âŒ DezavantajlarÄ±: ...

SeÃ§enek B: [YÃ¶ntem 2]
  âœ… AvantajlarÄ±: ...
  âŒ DezavantajlarÄ±: ...

SeÃ§enek C: [YÃ¶ntem 3]
  âœ… AvantajlarÄ±: ...
  âŒ DezavantajlarÄ±: ...

Bence [X] seÃ§eneÄŸi daha iyi Ã§Ã¼nkÃ¼ [sebep].
Sizce hangisini kullanalÄ±m?"
```

**ADIM 2**: KullanÄ±cÄ± seÃ§imi yaptÄ±ktan SONRA kodla

**ADIM 3**: Kod yazarken proaktif Ã¶neriler sun:

```
"Bu kodu yazarken ÅŸunu fark ettim:
â— Bunu [ÅŸu ÅŸekilde] yapsak daha iyi olur Ã§Ã¼nkÃ¼ [sebep]
â— Bunun yerine [alternatif] kullanÄ±rsak [fayda] saÄŸlarÄ±z
Ne dersiniz?"
```

#### 2. Test ve Kalite Kontrol ğŸ§ª

âœ… **Her deÄŸiÅŸiklikte MUTLAKA:**

1. Test kodu yaz
2. Kodu Ã§alÄ±ÅŸtÄ±r/test et
3. Hata varsa dÃ¼zelt
4. Sonucu bildir

```
"âœ… Kod yazÄ±ldÄ±
âœ… Test yazÄ±ldÄ±
âœ… Test Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±
âŒ Hata bulundu: [hata aÃ§Ä±klamasÄ±]
âœ… Hata dÃ¼zeltildi
âœ… Yeniden test edildi - baÅŸarÄ±lÄ±"
```

#### 3. Ä°yileÅŸtirme ve Optimizasyon ğŸ’¡

**SÃ¼rekli daha iyisini ara ve Ã¶ner:**

Her kodda ÅŸunlarÄ± sorgula:

- ğŸ” "Bu daha performanslÄ± yapÄ±labilir mi?"
- ğŸ” "Daha temiz bir yÃ¶ntem var mÄ±?"
- ğŸ” "GÃ¼venlik aÃ§Ä±ÄŸÄ± var mÄ±?"
- ğŸ” "Daha iyi bir kÃ¼tÃ¼phane/yÃ¶ntem var mÄ±?"

**Proaktif uyarÄ±lar:**

```
âš ï¸ "Bu yaklaÅŸÄ±m Ã§alÄ±ÅŸÄ±r ama ÅŸunu fark ettim: [sorun]
ğŸ’¡ Bunun yerine [alternatif] kullanÄ±rsak:
   âœ… [Fayda 1]
   âœ… [Fayda 2]
   âœ… [Fayda 3]
Ne dersiniz, deÄŸiÅŸtirelim mi?"
```

#### 4. Kod Yazma SÄ±rasÄ± ğŸ“‹

```
1. Ã–nce seÃ§enekleri sun ve tartÄ±ÅŸ
2. SeÃ§im yapÄ±ldÄ±ktan sonra kod yaz
3. Test yaz
4. Ã‡alÄ±ÅŸtÄ±r ve test et
5. Hata varsa dÃ¼zelt
6. Ä°yileÅŸtirme Ã¶nerileri sun
7. KullanÄ±cÄ± onayladÄ±ktan sonra finalize et
```

### Ã–zel Durumlar

#### Acil Durumlar ğŸš¨

Sadece ÅŸu durumlarda hemen kod yaz (tartÄ±ÅŸma atlama):

- "Acil" kelimesi kullanÄ±ldÄ±ysa
- "HÄ±zlÄ±" kelimesi kullanÄ±ldÄ±ysa
- "Åimdi yap" denildiyse

Ama yine de kÄ±sa bir uyarÄ± ver:

```
"Hemen yapÄ±yorum ama ÅŸunu bilmenizi isterim: [Ã¶nemli not]"
```

#### Belirsiz Ä°stekler â“

EÄŸer istek belirsizse:

```
"Bunu birkaÃ§ farklÄ± ÅŸekilde anlayabiliyorum:

1. [Yorum 1] - Bu mu demek istediniz?
2. [Yorum 2] - Yoksa bu mu?
3. [Yorum 3] - Ya da bu mu?

Hangisi doÄŸru? Ya da baÅŸka bir ÅŸey mi?"
```

### Ã–rnekler

#### âŒ KÃ–TÃœ YaklaÅŸÄ±m (YapmayacaÄŸÄ±m):

```
KullanÄ±cÄ±: "Bir upload componenti yap"
Claude: [Hemen 100 satÄ±r kod yazar]
```

#### âœ… Ä°YÄ° YaklaÅŸÄ±m (YapacaÄŸÄ±m):

```
KullanÄ±cÄ±: "Bir upload componenti yap"

Claude: "Upload component iÃ§in 3 yaklaÅŸÄ±m var:

A) Basit drag-drop:
   âœ… HÄ±zlÄ± implementasyon
   âŒ SÄ±nÄ±rlÄ± Ã¶zellik

B) Multi-file + preview:
   âœ… Daha kullanÄ±cÄ± dostu
   âŒ Biraz daha karmaÅŸÄ±k

C) Advanced (progress bar, pause/resume):
   âœ… En iyi UX
   âŒ En karmaÅŸÄ±k

Projeniz iÃ§in B seÃ§eneÄŸi yeterli ve kullanÄ±cÄ± dostu olur.
Hangisini istersiniz?"

[KullanÄ±cÄ± seÃ§im yapar]

Claude: "B seÃ§eneÄŸi iÃ§in kodluyorum.
ğŸ’¡ Bu arada: React-dropzone yerine native input kullanÄ±rsak
bundle size 50KB azalÄ±r. React-dropzone kullanalÄ±m mÄ±
yoksa native ile mi gidelim?"
```

---

**Son GÃ¼ncelleme**: 4 KasÄ±m 2025
**Proje Versiyonu**: 0.1.0
**Next.js**: 16.0.1
**React**: 19.2.0

---

## ğŸ†• Son DeÄŸiÅŸiklikler (4 KasÄ±m 2025)

1. **Ä°hale Scraper Metadata Caching Sistemi** (En Son)
   - Ä°ki aÅŸamalÄ± veri Ã§ekme: Liste sayfasÄ± + Detay sayfasÄ±
   - Map-based metadata caching (`Map<sourceId, metadata>`)
   - %100 doÄŸruluk: BaÅŸlÄ±k, kurum, ÅŸehir bilgileri her zaman doÄŸru
   - DOM deÄŸiÅŸikliklerine daha dayanÄ±klÄ± yapÄ±
   - Batch processing: 5'li gruplar halinde database kayÄ±t
   - Test sonuÃ§larÄ±: 140+ ihale baÅŸarÄ±yla kaydedildi

2. **Ä°hale Takip UI Ä°yileÅŸtirmeleri**
   - BaÅŸlÄ±k kolonu kaldÄ±rÄ±ldÄ± (gereksiz tekrar)
   - Sadece kurum adÄ± gÃ¶sterimi (daha odaklÄ±)
   - Daha temiz ve okunabilir liste gÃ¶rÃ¼nÃ¼mÃ¼

3. **Ä°hale Scraper Sistemi Eklendi**
   - Otomatik ihale takibi (gÃ¼nde 1 kere)
   - Gemini AI ile kategorilendirme
   - SQLite database entegrasyonu
   - Cron job yapÄ±sÄ± (Vercel)

4. **Stores KlasÃ¶rÃ¼ Yeniden Organize Edildi**
   - `/lib/store` â†’ `/lib/stores` (Ã§oÄŸul)
   - menu-store.ts ve price-store.ts taÅŸÄ±ndÄ±

5. **API YapÄ±sÄ± GeniÅŸletildi**
   - `/api/ai/*` - AI analiz endpoints
   - `/api/cron/*` - Cron job endpoints
   - `/api/ihale-scraper/*` - Scraper yÃ¶netim

6. **Gemini API Quota YÃ¶netimi**
   - Rate limiting stratejisi eklendi
   - Retry mekanizmasÄ±
   - Quota kontrolÃ¼ ve uyarÄ±lar

7. **UI Ä°yileÅŸtirmeleri**
   - MenÃ¼ planlayÄ±cÄ±ya kategori filtreleme
   - Market fiyatlarÄ± sayfasÄ± UI tutarlÄ±lÄ±ÄŸÄ±
   - "Pilav" â†’ "YardÄ±mcÄ± Yemek" kategori deÄŸiÅŸikliÄŸi

## ğŸ—ï¸ Mimari KalÄ±plar

### 1. Metadata Caching Pattern (Ä°hale Scraper)

**Problem**: Detay sayfalarÄ±ndaki DOM selektÃ¶rleri gÃ¼venilir deÄŸil, veriler eksik gelebilir.

**Ã‡Ã¶zÃ¼m**: Ä°ki aÅŸamalÄ± veri Ã§ekme
```typescript
// 1. AÅŸama: Liste sayfasÄ±ndan metadata'yÄ± cache'le
private metadataCache: Map<string, { title: string; organization: string; city: string }> = new Map();

private extractMetadataFromListPage(html: string): void {
  const $ = cheerio.load(html);
  $('div.card').each((i, card) => {
    const sourceId = extractIdFromUrl($(card).find('a').attr('href'));
    const title = $(card).find('.title').text();
    const organization = $(card).find('.organization').text();
    const city = $(card).find('.city').text();

    this.metadataCache.set(sourceId, { title, organization, city });
  });
}

// 2. AÅŸama: Detay sayfasÄ±nda cache'den al, detaylarla zenginleÅŸtir
private parseDetailPage(html: string, url: string): ScrapedTender | null {
  const sourceId = extractIdFromUrl(url);
  const cachedMetadata = this.metadataCache.get(sourceId);

  // Ã–NCE CACHE'DEN AL!
  let title = cachedMetadata?.title || extractFromDetailPage();
  let organization = cachedMetadata?.organization || extractFromDetailPage();
  // ...
}
```

**Avantajlar:**
- âœ… %100 doÄŸruluk garantisi
- âœ… DOM deÄŸiÅŸikliklerine daha dayanÄ±klÄ±
- âœ… Fallback mekanizmasÄ± (detay sayfa ikinci seÃ§enek)
- âœ… KayÄ±p veri yok

### 2. Batch Processing with Callbacks

**Pattern**: BÃ¼yÃ¼k veri setlerini kÃ¼Ã§Ã¼k gruplara bÃ¶l, her grup sonrasÄ± callback Ã§aÄŸÄ±r

```typescript
// BaseScraper sÄ±nÄ±fÄ±na callback ekle
protected onBatchComplete?: (tenders: ScrapedTender[]) => Promise<void>;

// Batch'leri iÅŸle ve callback Ã§aÄŸÄ±r
for (let i = 0; i < allTenders.length; i += BATCH_SIZE) {
  const batch = allTenders.slice(i, i + BATCH_SIZE);

  if (this.onBatchComplete) {
    await this.onBatchComplete(batch); // Database'e kaydet
  }
}

// Orchestrator'da kullanÄ±m
const onBatchComplete = async (batchTenders: ScrapedTender[]) => {
  const saved = await TenderDatabase.saveTenders(batchTenders);
  console.log(`âœ… ${saved.newCount} yeni ihale kaydedildi`);
};

const scraper = new IhalebulScraper(config, onBatchComplete);
```

**Avantajlar:**
- âœ… Bellek kullanÄ±mÄ± optimize
- âœ… Ä°lerleyiÅŸ takibi kolay
- âœ… Hata durumunda kayÄ±p minimum
- âœ… GerÃ§ek zamanlÄ± feedback

### 3. Text Extraction from Nested DOM (Clone Pattern)

**Problem**: `.text()` kullanÄ±nca iÃ§ iÃ§e elemanlarÄ±n text'leri birleÅŸiyor

```typescript
// âŒ KÃ–TÃœ - Text'ler birleÅŸir
const city = $('.city-container').text();
// "icon Ä°stanbul" (icon element + text birleÅŸti)

// âœ… Ä°YÄ° - Clone pattern
const city = $('.city-container')
  .clone()           // Klonla
  .children()        // Alt elemanlarÄ± seÃ§
  .remove()          // Sil
  .end()             // Klona geri dÃ¶n
  .text()            // ArtÄ±k sadece text
  .trim();
// "Ä°stanbul" (sadece text, icon yok)
```
